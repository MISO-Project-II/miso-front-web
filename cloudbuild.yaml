steps:
  - id: Package image
    name: gcr.io/cloud-builders/npm
    args: [ 'install' ]
    volumes:
      - name: 'myvolume'
        path: '/persistent_volume'
  - name: 'gcr.io/$PROJECT_ID/sonar-scanner:latest'
    args:
      - '-Dsonar.host.url=http://34.67.142.84:9001'
      - '-Dsonar.login=admin'
      - '-Dsonar.password=admin123'
      - '-Dsonar.projectKey=sport-app-mobie'
      - '-Dsonar.projectName=sport-app-mobie'
      - '-Dsonar.projectVersion=1.25.4'
      - '-Dsonar.sourceEncoding=UTF-8'
      - '-Dsonar.sources=src'
      - '-Dsonar.test=src/app/pages/error/*.spec.ts'
      - '-Dsonar.typescript.lcov.reportPaths=coverage/SportApp/lcov.info'

  - name: gcr.io/cloud-builders/npm
    entrypoint: bash
    args:
      - -c
      - |
        test --watch=false --code-coverage --source-map=false 

  - id: Android execution
    name: gcr.io/cloud-builders/npm
    entrypoint: bash
    args:
      - -c
      - |
        npm i xlsx --save
        npm install @capacitor/core
        npm install @capacitor/cli
        npm install @capacitor/android
        npx cap add android
        npm run build
        npx cap sync
    volumes:
      - name: 'myvolume'
        path: '/persistent_volume'
#  - name: gradle:5.6.2-jdk8
#    entrypoint: bash
#    args:
#      - -c
#      - |
#        cd android/
#        gradlew installDebug
#    volumes:
#      - name: 'myvolume'
#        path: '/persistent_volume'


substitutions:
  _IMAGE_NAME: mobile-app
